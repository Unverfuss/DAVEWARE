<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DAVEWARE™ CARD PRINTER V1</title>

<style>
   body {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100vh;
}

.yogurt-button-wrapper,
.aura-button-wrapper {
  position: relative;
  display: center;
  align-items: center;
  margin-top: 10px;
  border-radius: 8px;
  background: black;
}

.yogurt-thumb,
.aura-thumb {
  width: 80px;
  height: 80px;
  border-radius: 8px;
  object-fit: contain;
  cursor: pointer;
  transition: border 0.2s ease;
}

.yogurt-options,
.aura-options {
  display: none;
  position: absolute;
  top: 0;
  left: 0;
  align-items: center;
  background: black;
  padding: 6px;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  z-index: 100;
  white-space: nowrap;
}

.yogurt-button-wrapper:hover .yogurt-options,
.aura-button-wrapper:hover .aura-options {
  display: block;
}

.yogurt-options img,
.aura-options img {
  width: 50px;
  height: 50px;
  margin: 4px;
  cursor: pointer;
  border-radius: 4px;
  transition: transform 0.2s ease;
}

.yogurt-options img:hover,
.aura-options img:hover {
  transform: scale(1.1);
}




.moves {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-top: 10px;
}

.move-row {
  display: grid;
  grid-template-columns: 2fr 1fr 1fr;
  gap: 10px;
}

}
.container {
  background-color: red;
}
p {
  color: white;
  font-size: 30px;
  margin: auto;
  font-family: sans-serif;
  font-weight: bold;
}
a:hover {
  background-color: black;
  animation-name: animatie;
  animation-duration: 2s;
  animation-direction: normal;
}

}
@keyframes moveDiagonal {
  from { background-position: 0 0; }
  to { background-position: 40px 40px; }
}

button {
  /* existing styles... */
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4); /* subtle shadow */
}

button:active {
  box-shadow: inset 0 2px 4px rgba(0,0,0,0.5); /* pressed effect */
}

#cardCanvas {
  opacity: 0;
  display: none;
  transition: opacity 0.3s ease;
  margin: 40px auto;
  border-radius: 8px;
  border: 1px solid #ccc;
  background: #fff;
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.25);
}

#cardCanvas.visible {
  display: block;
  opacity: 1;
}

#cardCanvas {
  transform: scale(0.5);         /* Shrink visually by 50% */
  transform-origin: center;  /* Control anchor point */
  margin: 40px auto;
}

.tier-selector {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-top: 20px;
}

.tier-selector button {
  width: 50px;             /* Equal width */
  height: 50px;            /* Equal height */
  border-radius: 50%;      /* Circle shape */
  background-color: #eee;
  cursor: pointer;
  transition: background-color 0.3s, border-color 0.3s;
    /* Ensure the button is exactly the size we define */
  adding: 0;               /* Remove any padding */
  box-sizing: border-box;   /* Ensure box-sizing includes border */
}

/* Remove generic 'active' if we're styling by type now */
.tier-selector button.active {
  border-color: #444;
}

/* Rarity styles */
.tier-selector button.uncommon {
  background-color: purple;
  border-color: purple;
}

.tier-selector button.rare {
  background-color: crimson;
  border-color: crimson;
}

.tier-selector button.legendary {
  background: linear-gradient(135deg, #d0d8e8, #f0f4ff);
  border-color: #aab6c8;
}

.tier-selector button.mythical {
  background: linear-gradient(135deg, #FFD700, #FFA500);
  border-color: goldenrod;
}

/* Hover styles by rarity */

.tier-selector button[data-value="1"]:hover {
  background-color: purple;
  border-color: purple;
}

.tier-selector button[data-value="2"]:hover {
  background-color: crimson;
  border-color: crimson;
}

.tier-selector button[data-value="3"]:hover {
  background: linear-gradient(135deg, #d0d8e8, #f0f4ff);
  border-color: #aab6c8;
}

.tier-selector button[data-value="4"]:hover {
  background: linear-gradient(135deg, #FFD700, #FFA500);
  border-color: goldenrod;
}

.tier-label {
  color: black;
  text-align: center;
  font-size: 18px;
  font-weight: bold;
  margin-top: 10px;
}

.card {
  position: relative;
  width: 400px;
  height: 600px;
  overflow: hidden;
  border-radius: 16px;
  box-shadow: 0 10px 20px rgba(0,0,0,0.2);
}

.card-background {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-size: cover;
  background-position: center;
  transition: background-image 0.3s ease;
  z-index: 0;
}

/* Ensure all other elements inside the card layer above the background */
.card *:not(.card-background) {
  position: relative;
  z-index: 1;
}
  </style>
</head>
<body>

<canvas id="bgCanvas" style="position: fixed; top: -41px; left: 0; z-index: -1;"></canvas>  
  
<div class="form-container">
  <h1>DAVEWARE™ CARD PRINTER</h1>

  <label for="imgUpload">Upload Image:</label>
  <input type="file" id="imgUpload" accept="image/*" />

  <div class="aura-selector">
<label>Choose Aura:</label>
<div class="aura-button-wrapper">
  <img id="selectedAura" src="https://raw.githubusercontent.com/Unverfuss/DAVEWARE/main/auras/autism.png" class="aura-thumb" />
  <div class="aura-options">
    <img src="https://raw.githubusercontent.com/Unverfuss/DAVEWARE/main/auras/autism.png" data-url="autism.png" crossorigin="anonymous">
    <img src="https://raw.githubusercontent.com/Unverfuss/DAVEWARE/main/auras/bum.png" data-url="bum.png" crossorigin="anonymous">
    <img src="https://raw.githubusercontent.com/Unverfuss/DAVEWARE/main/auras/green.png" data-url="green.png" crossorigin="anonymous">
    <img src="https://raw.githubusercontent.com/Unverfuss/DAVEWARE/main/auras/fly.png" data-url="fly.png" crossorigin="anonymous">
    <img src="https://raw.githubusercontent.com/Unverfuss/DAVEWARE/main/auras/gpa.png" data-url="gpa.png" crossorigin="anonymous">
    <img src="https://raw.githubusercontent.com/Unverfuss/DAVEWARE/main/auras/funny.png" data-url="funny.png" crossorigin="anonymous">
    <img src="https://raw.githubusercontent.com/Unverfuss/DAVEWARE/main/auras/nerd.png" data-url="nerd.png" crossorigin="anonymous">
    <img src="https://raw.githubusercontent.com/Unverfuss/DAVEWARE/main/auras/lazy.png" data-url="lazy.png" crossorigin="anonymous">
  </div>
</div>
</div>
  
  <div class="tier-selector" id="tierButtons">
    <button data-value="1" title="Uncommon"></button>
    <button data-value="2" title="Rare"></button>
    <button data-value="3" title="Legendary"></button>
    <button data-value="4" title="Mythical"></button>
  </div>

  <p id="tierLabel" class="tier-label">Select Rarity</p>

  <label for="cardName">Card Name:</label>
  <input type="text" id="cardName" placeholder="e.g. Happy Dave" />

  <label for="description">Description:</label>
  <textarea id="description" placeholder="e.g. A joyful and cheery Dave" rows="4" style="width: 100%;"></textarea>

    <label for="series">Series:</label>
  <input type="text" id="series" placeholder="e.g. Series 1 / DAVES" />

  <label>Moves:</label>
<div id="moves" class="moves">
  <div class="move-row">
    <input type="text" placeholder="ATK" class="move-name" />
    <input type="text" placeholder="##%" class="move-percent" />
    <input type="text" placeholder="99" class="move-number" />
  </div>
    <div class="move-row">
    <input type="text" placeholder="DEF" class="move-name" />
    <input type="text" placeholder="##%" class="move-percent" />
    <input type="text" placeholder="99" class="move-number" />
  </div>
    <div class="move-row">
    <input type="text" placeholder="ACT" class="move-name" />
    <input type="text" placeholder="##%" class="move-percent" />
    <input type="text" placeholder="99" class="move-number" />
  </div>
</div>

  <div class="yogurt-selector">
  <label>Choose Yogurt:</label>
  <div class="yogurt-button-wrapper">
    <img id="selectedYogurt" src="https://raw.githubusercontent.com/Unverfuss/DAVEWARE/main/yogurt/black_cherry.png" class="yogurt-thumb" />
   <div class="yogurt-options">
      <img src="https://raw.githubusercontent.com/Unverfuss/DAVEWARE/main/yogurt/black_cherry.png" data-url="black_cherry.png" crossorigin="anonymous">
      <img src="https://raw.githubusercontent.com/Unverfuss/DAVEWARE/main/yogurt/key_lime.png" data-url="key_lime.png" crossorigin="anonymous">
      <img src="https://raw.githubusercontent.com/Unverfuss/DAVEWARE/main/yogurt/cookie_dough.png" data-url="cookie_dough.png" crossorigin="anonymous">
      <img src="https://raw.githubusercontent.com/Unverfuss/DAVEWARE/main/yogurt/key_lime_crumble.png" data-url="key_lime_crumble.png" crossorigin="anonymous">
      <img src="https://raw.githubusercontent.com/Unverfuss/DAVEWARE/main/yogurt/peanut_butter_cup.png" data-url="peanut_butter_cup.png" crossorigin="anonymous">
      <img src="https://raw.githubusercontent.com/Unverfuss/DAVEWARE/main/yogurt/strawberry_banana.png" data-url="strawberry_banana.png" crossorigin="anonymous">
  </div>
</div>
</div>
  
<div class="number-input-wrapper">
  <label for="cardNumber">Number (15–99):</label>
  <input type="number" id="cardNumber" name="cardNumber" min="15" max="99" value="15">
</div>

  <div class="button-group">
    <button onclick="generateCard()">PRINT CARD</button>
    <button onclick="downloadCard()">DOWNLOAD CARD</button>
  </div>
</div>

<canvas id="cardCanvas" width="750" height="1050"></canvas>


</div>

<script>
  const bgCanvas = document.getElementById("bgCanvas");
  const canvas = document.getElementById("cardCanvas");
  const bgCtx = bgCanvas.getContext("2d");
  const tierButtons = document.querySelectorAll('#tierButtons button');
  const tierLabel = document.getElementById('tierLabel');

  const auraToForegroundMap = {
  "autism.png": "AUT.png",
  "bum.png": "BUM.png",
  "green.png": "GRN.png",
  "fly.png": "FLY.png",
  "gpa.png": "GPA.png",
  "funny.png": "FUN.png",
  "nerd.png": "NRD.png",
  "lazy.png": "LAZ.png"
};
  
  let rarityImageMap = {};
  const rarityBgUrls = {
    1: "https://raw.githubusercontent.com/Unverfuss/DAVEWARE/refs/heads/main/Background.png",
    2: "https://raw.githubusercontent.com/Unverfuss/DAVEWARE/refs/heads/main/Background2.png",
    3: "https://raw.githubusercontent.com/Unverfuss/DAVEWARE/refs/heads/main/Background3.png",
    4: "https://raw.githubusercontent.com/Unverfuss/DAVEWARE/refs/heads/main/Background4.png"
  };

  let selectedYogurtUrl = "https://raw.githubusercontent.com/Unverfuss/DAVEWARE/main/yogurt/black_cherry.png";
let selectedAuraUrl = "https://raw.githubusercontent.com/Unverfuss/DAVEWARE/main/auras/autism.png";
let selectedForegroundUrl = "https://raw.githubusercontent.com/Unverfuss/DAVEWARE/main/foregrounds/AUT.png";

document.querySelectorAll('.yogurt-options img').forEach(img => {
  img.addEventListener('click', () => {
    const url = img.getAttribute('src');
    document.getElementById('selectedYogurt').src = url;
    selectedYogurtUrl = url;
  });
});

document.querySelectorAll('.aura-options img').forEach(img => {
  img.addEventListener('click', () => {
    const url = img.getAttribute('src');
    document.getElementById('selectedAura').src = url;
    selectedAuraUrl = url;

    // extract just the filename from URL
    const filename = url.split('/').pop();
    const fgFile = auraToForegroundMap[filename];
    selectedForegroundUrl = `https://raw.githubusercontent.com/Unverfuss/DAVEWARE/main/foregrounds/${fgFile}`;
  });
});
  
  
  tierButtons.forEach(button => {
    button.addEventListener('click', () => {
      const val = parseInt(button.getAttribute('data-value'));
      window.selectedScale = val;
      
    });
  });

  const tierNames = {
    1: "Uncommon",
    2: "Rare",
    3: "Legendary",
    4: "Mythical"
  };

  const tierClasses = {
    1: "uncommon",
    2: "rare",
    3: "legendary",
    4: "mythical"
  };

  tierButtons.forEach(button => {
    button.addEventListener('click', () => {
      const val = parseInt(button.getAttribute('data-value'));
      tierButtons.forEach(b => {
        const bVal = parseInt(b.getAttribute('data-value'));
        b.classList.toggle('active', bVal <= val);
      });
      tierLabel.textContent = tierNames[val];
      window.selectedTier = tierNames[val];
    });
  });

  function resizeCanvas() {
    bgCanvas.width = window.innerWidth;
    bgCanvas.height = window.innerHeight;
  }

  resizeCanvas();
  window.addEventListener("resize", resizeCanvas);

  const lineColor = "#80d182";
  const backgroundColor = "#4ea364";
  const speed = 0.5;
  const spacing = 50;
  let offset = 0;

  function drawBackground() {
    bgCtx.fillStyle = backgroundColor;
    bgCtx.fillRect(0, 0, bgCanvas.width, bgCanvas.height);

    bgCtx.strokeStyle = lineColor;
    bgCtx.lineWidth = 10;

    const diagLength = bgCanvas.width + bgCanvas.height;
    bgCtx.beginPath();

    for (let i = -diagLength; i < diagLength; i += spacing) {
      bgCtx.moveTo(i + offset, 0);
      bgCtx.lineTo(i - bgCanvas.height + offset, bgCanvas.height);
    }

    bgCtx.stroke();
  }

  function animate() {
    offset = (offset + speed) % spacing;
    drawBackground();
    requestAnimationFrame(animate);
  }

  animate();

 function downloadCard() {
  const canvas = document.getElementById("cardCanvas");
  
  // Check if the canvas is tainted
  try {
    // Attempt to export to PNG (this will throw an error if the canvas is tainted)
    const dataUrl = canvas.toDataURL("image/png");
    
    const link = document.createElement("a");
    link.download = "custom_card.png";
    link.href = dataUrl;
    link.click();
  } catch (e) {
    console.error("Failed to download canvas due to tainted canvas:", e);
    alert("Unable to download due to security restrictions. Please check the content on the canvas.");
  }
}

// Load an image with proper CORS (if needed)
const img = new Image();
img.crossOrigin = 'Anonymous';  // This is important for cross-origin images
img.src = 'https://example.com/path/to/image.jpg';

img.onload = function() {
  const canvas = document.getElementById("cardCanvas");
  const ctx = canvas.getContext("2d");
  
  // Draw your image (or text, etc.)
  ctx.drawImage(img, 0, 0);
  
  // Add any other canvas drawing logic here (text, shapes, etc.)
  
  // Now the canvas should not be tainted, and you can download it
  downloadCard();
};

function drawEmbossedText(ctx, text, x, y, fontSize = 30, color = "#ffffff") {
  ctx.font = `${fontSize}px 'Comic Sans MS', cursive`;

  // Set blending mode to 'multiply' for the shadow
  ctx.globalCompositeOperation = 'darker';

  // Shadow layer (black with 50% opacity)
  ctx.fillStyle = "rgba(0, 0, 0, 0.5)";  // Black with 50% opacity
  ctx.fillText(text, x, y - 3);  // Slight offset for shadow

  // Reset blending mode to default for the text
  ctx.globalCompositeOperation = 'source-over';

  // Foreground color text
  ctx.fillStyle = color;  // Set the text color to the passed 'color' argument
  ctx.fillText(text, x, y);

   // Set blending mode to 'multiply' for the shadow
  ctx.globalCompositeOperation = 'lighter';

  // Shadow layer (black with 50% opacity)
  ctx.fillStyle = "rgba(255, 255, 255, .2)";  // Black with 50% opacity
  ctx.fillText(text, x, y + 2);  // Slight offset for shadow
  
    // Reset blending mode to default for the text
  ctx.globalCompositeOperation = 'source-over';
}
  
async function generateCard() {
  const canvas = document.getElementById("cardCanvas");
  const ctx = canvas.getContext("2d");
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (Object.keys(rarityImageMap).length === 0) {
    await loadRarityImages(); // load images only once
  }

  const rarity = window.selectedScale || 1;
  const bg = rarityImageMap[rarity];
  ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);

  const fg = await loadImage(selectedForegroundUrl);
  ctx.drawImage(fg, 19, 19, 712, 1012);

  const ib = await loadImage("https://raw.githubusercontent.com/Unverfuss/DAVEWARE/refs/heads/main/Rectangle%201.png");
  ctx.drawImage(ib, 36, 115, 679, 454);

  const b = await loadImage("https://raw.githubusercontent.com/Unverfuss/DAVEWARE/refs/heads/main/boxes.png");
  ctx.drawImage(b, 36, 23, 679, 1005);

  const thermos = await
loadImage("https://raw.githubusercontent.com/Unverfuss/DAVEWARE/refs/heads/main/thermos.png")
  ctx.drawImage(thermos, 538, 570, 99, 191)
  
  const cardNumber = document.getElementById("cardNumber").value;
  drawEmbossedText(ctx, cardNumber, 560, 720, 50, "#bd1616");
  
  const file = document.getElementById("imgUpload").files[0];
  if (file) {
    const userImg = await fileToImage(file);
    ctx.drawImage(userImg, 92, 169, 569, 345);
  }

  const msk = await loadImage("https://raw.githubusercontent.com/Unverfuss/DAVEWARE/refs/heads/main/mask.png");
  ctx.drawImage(msk, 63, 140, 625, 401);

  const empty = await loadImage("https://raw.githubusercontent.com/Unverfuss/DAVEWARE/refs/heads/main/empty_slot_1.png")
  ctx.drawImage(empty, 451, 73, 30, 30)
  ctx.drawImage(empty, 516, 73, 30, 30)
  ctx.drawImage(empty, 581, 73, 30, 30)
  ctx.drawImage(empty, 646, 73, 30, 30)

  const gem = await loadImage("https://raw.githubusercontent.com/Unverfuss/DAVEWARE/refs/heads/main/slot_1.png");
  const gemXPositions = [451, 516, 581, 646];
  for (let i = 0; i < rarity; i++) {
    ctx.drawImage(gem, gemXPositions[i], 73, 30, 30);
  }

  if (selectedYogurtUrl) {
  const yogurtImg = await loadImage(selectedYogurtUrl);
  ctx.drawImage(yogurtImg, 460, 825, 200, 160); // Adjust position and size as needed
}

  if (selectedAuraUrl) {
  const auraImg = await loadImage(selectedAuraUrl);
  ctx.drawImage(auraImg, 345, 60, 60, 60); // Adjust position as needed
}
 
  
  // Embossed Card Name
  drawEmbossedText(ctx, document.getElementById("cardName").value, 84, 100, 30);

    // Embossed Series Name
  drawEmbossedText(ctx, document.getElementById("series").value, 65, 55, 18);
  
 // Multiline Embossed Description
const descriptionText = document.getElementById("description").value;
const lines = descriptionText.split('\n');
lines.forEach((line, i) => {
  drawEmbossedText(ctx, line, 95, 830 + i * 38, 24); // Adjust Y position and font size as needed
});

  // Draw Moves with emboss
  const moveNames = document.querySelectorAll('.move-name');
  const movePercents = document.querySelectorAll('.move-percent');
  const moveNumbers = document.querySelectorAll('.move-number');

  for (let i = 0; i < moveNames.length; i++) {
    const name = moveNames[i].value || "";
    const percent = movePercents[i].value || "";
    const number = moveNumbers[i].value || "";

    const y = 620 + i * 40;

    drawEmbossedText(ctx, name, 100, y, 24);
    drawEmbossedText(ctx, percent, 320, y, 18);
    drawEmbossedText(ctx, number, 420, y, 18);
  }

  drawEmbossedText(ctx, "©2025 DAVEWARE™ / UNVERFUSS", 230, 1040, 14);
  
  canvas.classList.add("visible");
}


  async function loadRarityImages() {
    for (const key in rarityBgUrls) {
      rarityImageMap[key] = await loadImage(rarityBgUrls[key]);
    }
  }

  function fileToImage(file) {
    return new Promise((resolve) => {
      const reader = new FileReader();
      reader.onload = (e) => {
        const img = new Image();
        img.onload = () => resolve(img);
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    });
  }

  function loadImage(src) {
    return new Promise((resolve) => {
      const img = new Image();
      img.onload = () => resolve(img);
      img.src = src;
    });
  }

  // Set default yogurt and aura URLs
  selectedYogurtUrl = "https://raw.githubusercontent.com/Unverfuss/DAVEWARE/main/yogurt/black_cherry.png";
  selectedAuraUrl = "https://raw.githubusercontent.com/Unverfuss/DAVEWARE/main/auras/autism.png";

  // Event listeners for yogurt selection
  document.querySelectorAll('.yogurt-options img').forEach(img => {
    img.addEventListener('click', () => {
      const url = img.getAttribute('src');
      document.getElementById('selectedYogurt').src = url;
      selectedYogurtUrl = url;
    });
  });

  // Event listeners for aura selection
  document.querySelectorAll('.aura-options img').forEach(img => {
    img.addEventListener('click', () => {
      const url = img.getAttribute('src');
      document.getElementById('selectedAura').src = url;
      selectedAuraUrl = url;
    });
  });

  // Expose functions globally
  window.generateCard = generateCard;
  window.downloadCard = downloadCard;
</script>

</body>
</html>
